<!DOCTYPE html>
<html>
    <head>
        <title>Submit HTML form data using AJAX</title>

        <!-- Import jQuery library -->
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

        <!-- Page styles -->
        <style>
            #postDetails, #updatedPost {
                display: none;
            }
        </style>
    </head>
    <body>
        <h2>Update Post Details</h2>
        <!-- Fetch the post as per the entered ID
            The ID is limited to 1 and 100 as per the JSONPlaceholder API -->
        <form id="postIdForm">
            <label for="postId">Enter Post ID:</label>
            <input type="number" id="postId" name="postId" min="1" max="100" required>
            <button type="submit">Fetch Post</button>
        </form>

        <!-- Display the returned post details -->
        <div id="postDetails">
            <h3>Post Details</h3>
            <form id="updateForm">
                <input type="hidden" id="postIdUpdate" name="postIdUpdate">
                <label for="title">Title:</label>
                <input type="text" id="title" name="title">
                <br>
                <label for="body">Body:</label>
                <textarea id="body" name="body"></textarea>
                <br>
                <div id="customFields">
                    <!-- Custom fields will be added here -->
                </div>
                <button type="button" id="addFieldButton">Add Custom Field</button>
                <br>
                <button type="submit">Update Post</button>
            </form>
        </div>

        <!-- Upon update, display the updated post details -->
        <div id="updatedPost">
            <h3>Updated Post</h3>
            <p><b>Title:</b> <span id="updatedTitle"></span></p>
            <p><b>Body:</b> <span id="updatedBody"></span></p>
            <div id="updatedCustomFields"></div>
        </div>

        <div id="response"></div>

        <script type="text/javascript">
            $(document).ready(function () {
                // Submit the entered post id
                $('#postIdForm').submit(function (event) {
                    event.preventDefault();

                    const postId = $('#postId').val();
                    /**
                     * Use GET request to fetch the post details.
                     * Populate the update form with the post data.
                     */
                    $.ajax({
                        url: `https://jsonplaceholder.typicode.com/posts/${postId}`,
                        method: 'GET',
                        success: function (data) {
                            $('#postIdUpdate').val(postId);
                            $('#title').val(data.title);
                            $('#body').val(data.body);
                            $('#postDetails').show();
                            $('#updatedPost').hide();
                            $('#response').html('');
                        },
                        error: function (error) {
                            $('#response').html(`<p>Error fetching post with ID ${postId}.</p>`);
                        },
                    });
                });

                /**
                 * Adds a set of two fields.
                 * @param {string} customKey which stores the custom key.
                 * @param {string} customValue which stores the custom value.
                 * They can be added dynamically and without a limit.
                 */
                $('#addFieldButton').click(function () {
                    const customFieldsDiv = $('#customFields');
                    const newField = `
                            <label for="customKey">Custom field key:</label>
                            <input type="text" class="custom-key" name="customKey" required>
                            <label for="customValue">Custom field value:</label>
                            <input type="text" class="custom-value" name="customValue" required>
                            <br>
                        `;
                    customFieldsDiv.append(newField); // The fields are added in the customFields div
                });

                /**
                 * Use the PUT method to update the post details.
                 */
                $('#updateForm').submit(function (event) {
                    event.preventDefault();

                    /**
                     * Get the values from the update form and store each in a variable.
                     */
                    const postId = $('#postIdUpdate').val();
                    const title = $('#title').val();
                    const body = $('#body').val();

                    /**
                     * Store the title and body in a variable postData.
                     * We shall use this variable to store the custom fields below.
                     */
                    const postData = {
                        title: title,
                        body: body,
                    };

                    /**
                     * Iterate through the custom keys.
                     * If there are some, add them to the postData object.
                     */
                    $('.custom-key').each(function (index) {
                        const customKey = $(this).val();
                        const customValue = $(`.custom-value:eq(${index})`).val();
                        if (customKey && customValue) {
                            postData[customKey] = customValue;
                        }
                    });

                    /**
                     * Submit using an AJAX request.
                     * This returns the post with the updated details.
                     */
                    $.ajax({
                        url: `https://jsonplaceholder.typicode.com/posts/${postId}`,
                        method: 'PUT',
                        data: JSON.stringify(postData),
                        headers: {
                            'Content-type': 'application/json; charset=UTF-8',
                        },
                        success: function (data) {
                            $('#postDetails').hide(); // Hide the update form
                            $('#updatedPost').show(); // Display the updated post details
                            $('#updatedTitle').text(data.title);
                            $('#updatedBody').text(data.body);
                            displayUpdatedCustomFields(data); // Display any custom fields available
                            $('#response').html(`<p>Post ID: ${postId} updated successfully.</p>`);
                        },
                        error: function (error) {
                            $('#response').html(`<p>Error updating post ID: ${postId}.</p>`);
                        },
                    });
                });
            });

            /**
             * Helper function which updates and displays custom fields.
             * @param {Object} data key-value pairs containing the post details
             */
            function displayUpdatedCustomFields(data) {
                const updatedCustomFieldsDiv = $('#updatedCustomFields');
                updatedCustomFieldsDiv.empty();

                for (const key in data) {
                    /**
                     * Checks for fields which aren't title or body.
                     * Selects only custom fields.
                     */
                    if (key !== 'title' && key !== 'body') {
                        const fieldValue = data[key];
                        const customFieldHtml = `
                                <p><b>${key}:</b> ${fieldValue}</p>
                            `;
                        updatedCustomFieldsDiv.append(customFieldHtml);
                    }
                }
            }
        </script>
    </body>
</html>
